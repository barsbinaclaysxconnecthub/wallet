<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>CorePay Withdrawal</title>
<style>
body{margin:0;background:#0b0f14;font-family:system-ui;color:white;display:flex;justify-content:center;align-items:center;height:100vh}
.card{background:#111827;padding:30px;border-radius:18px;width:340px;box-shadow:0 0 30px rgba(0,0,0,.4)}
input,select{width:100%;padding:12px;margin:10px 0;background:#0b0f14;border:1px solid #263041;border-radius:10px;color:white}
button{width:100%;padding:14px;border:none;border-radius:12px;background:#22c55e;color:white;font-weight:700;cursor:pointer;transition:.3s}
button.disabled{background:#555;color:#ccc;cursor:not-allowed;}
.small{opacity:.7;font-size:13px;margin-top:10px;text-align:center}
.loading-dots span{animation:blink 1.4s infinite; font-weight:bold;}
.loading-dots span:nth-child(2){animation-delay:.5s;}
.loading-dots span:nth-child(3){animation-delay:.10s;}
@keyframes blink{0%,80%,100%{opacity:0}40%{opacity:1}}

/* Slide Note */
#slideNote {
  position:fixed;
  center:-100px;
  left:50%;
  transform:translateX(-50%);
  background:#f97316;
  color:white;
  padding:12px 20px;
  border-radius:12px;
  font-size:14px;
  box-shadow:0 0 15px rgba(0,0,0,0.5);
  transition:bottom 0.5s ease-in-out;
  z-index:999;
}
</style>
</head>
<body>

<div class="card">
<h2>Withdrawal</h2>
<select id="coin">
<option>BTC</option><option>SOL</option><option>TRX</option>
<option>USDT-TRC20</option><option>USDT-ERC20</option>
</select>
<input id="amt" placeholder="Amount">
<input id="destWallet" placeholder="Destination wallet">
<button id="withdrawBtn" onclick="withdraw()">Submit Withdrawal</button>
<div class="small" id="timer"></div>
<br>
<a href="#" onclick="redirectHome()" style="color:white">← Back</a>
</div>

<div id="slideNote">You need to have a minimum balance of $600 in your connected and receiving wallet address to enable withdrawal being successful.</div>

<script>
document.addEventListener("DOMContentLoaded", ()=>{
const wallet = localStorage.wallet || "demo";
const key = "corepay_"+wallet;
let data = JSON.parse(localStorage.getItem(key)) || {balance:0.042, coin:"BTC", pending:[], history:[], withdrawalHistory:[]};
const withdrawBtn = document.getElementById("withdrawBtn");
const timerEl = document.getElementById("timer");

function save(){ localStorage.setItem(key, JSON.stringify(data)); }

function startTimer(){
if(!data.withdrawal){ timerEl.innerText=""; return; }
function update(){ 
let d = data.withdrawal - Date.now();
if(d<=0){ timerEl.innerText="Withdrawal window passed"; withdrawBtn.disabled=true; withdrawBtn.classList.add("disabled"); return;}
let h=Math.floor(d/3600000); let m=Math.floor((d%3600000)/60000); let s=Math.floor((d%60000)/1000);
timerEl.innerText="Scheduled in "+h+"h "+m+"m "+s+"s";
}
update(); setInterval(update,1000);
}
startTimer();

// ================= WITHDRAWAL FUNCTION WITH ANIMATION =================
window.withdraw = function(){
let amount=parseFloat(document.getElementById("amt").value);
let dest=document.getElementById("destWallet").value.trim();
let coin=document.getElementById("coin").value;
if(!amount||!dest){alert("Enter amount and destination wallet");return;}

withdrawBtn.disabled=true;
withdrawBtn.innerText="Processing...";
withdrawBtn.style.background="white";
withdrawBtn.style.color="#0b0f14";

// 5 seconds processing animation
setTimeout(()=>{
  // Failure message
  withdrawBtn.innerText="Withdrawal Failed – Can't read enough balance";
  withdrawBtn.style.background="#f6465d";
  withdrawBtn.style.color="white";

  // Update history
  data.history.push(`Withdrawal of ${amount} ${coin} to ${dest} failed | ${new Date().toLocaleTimeString()}`);
  save();

  // Show slide note
  const slide = document.getElementById("slideNote");
  slide.style.bottom="20px";
  setTimeout(()=>{ slide.style.bottom="-100px"; },15000);

  // Redirect to home
  setTimeout(()=>{
    location="home.html";
  },10000);

},5000);
}

// Redirect function
window.redirectHome = function(){
document.body.innerHTML="<div style='color:white;text-align:center;margin-top:50vh'>Redirecting to Dashboard<span class='loading-dots'><span>.</span><span>.</span><span>.</span></span></div>";
setTimeout(()=>location="home.html",6000);
}
});
</script>
</body>
</html>
